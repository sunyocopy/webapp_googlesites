<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Face Analysis - 468 Points</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
  
  <style>
    body { margin: 0; background: #000; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    canvas { position: absolute; border-radius: 15px; box-shadow: 0 0 30px rgba(0, 255, 0, 0.2); max-width: 90%; max-height: 80vh; transform: scaleX(-1); }
    video { display: none; }
    .status-box { position: absolute; top: 20px; left: 20px; background: rgba(0, 255, 0, 0.1); border: 1px solid #00FF00; padding: 15px; border-radius: 10px; z-index: 10; min-width: 200px; backdrop-filter: blur(5px); }
    .status-text { color: #00FF00; font-size: 24px; font-weight: bold; margin: 0; text-shadow: 0 0 10px rgba(0,255,0,0.5); }
  </style>
</head>
<body>
  <div class="status-box">
    <p class="status-text" id="face_status">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...</p>
    <p style="margin: 5px 0 0 0; font-size: 12px; color: #aaa;">MediaPipe Face Mesh 468 Points</p>
  </div>
  
  <video id="input_video"></video>
  <canvas id="output_canvas"></canvas>

  <script>
    const videoElement = document.getElementById('input_video');
    const canvasElement = document.getElementById('output_canvas');
    const canvasCtx = canvasElement.getContext('2d');
    const statusText = document.getElementById('face_status');

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î 2 ‡∏à‡∏∏‡∏î
    function getDistance(p1, p2) {
      return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤
    function classifyFace(landmarks) {
      // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏ö‡∏ï‡∏≤ (Eye Aspect Ratio)
      const leftEyeVertical = getDistance(landmarks[159], landmarks[145]);
      const rightEyeVertical = getDistance(landmarks[386], landmarks[374]);
      
      // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡πâ‡∏°
      const mouthWidth = getDistance(landmarks[61], landmarks[291]);
      const mouthHeight = getDistance(landmarks[13], landmarks[14]);
      const faceWidth = getDistance(landmarks[234], landmarks[454]); // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤

      const smileRatio = mouthWidth / faceWidth;

      // ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à
      if (leftEyeVertical < 0.012 && rightEyeVertical < 0.012) {
        return "‡∏´‡∏•‡∏±‡∏ö‡∏ï‡∏≤ üò¥";
      }
      
      if (smileRatio > 0.45) {
        return "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏¥‡πâ‡∏° üòä";
      }

      if (mouthHeight > 0.04) {
        return "‡∏≠‡πâ‡∏≤‡∏õ‡∏≤‡∏Å/‡∏ï‡∏Å‡πÉ‡∏à üò≤";
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏°‡∏∏‡∏°‡∏õ‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤ (‡∏°‡∏∏‡∏°‡∏õ‡∏≤‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏¥‡∏°‡∏ù‡∏µ‡∏õ‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)
      if (landmarks[61].y > landmarks[14].y && landmarks[291].y > landmarks[14].y) {
        return "‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏à‡∏∞‡πÄ‡∏®‡∏£‡πâ‡∏≤ üòü";
      }

      return "‡∏õ‡∏Å‡∏ï‡∏¥/‡πÄ‡∏â‡∏¢‡πÜ üòê";
    }

    function onResults(results) {
      canvasElement.width = results.image.width;
      canvasElement.height = results.image.height;

      canvasCtx.save();
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
      
      // ‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á (‡∏™‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏£‡∏∞‡∏à‡∏Å)
      canvasCtx.translate(canvasElement.width, 0);
      canvasCtx.scale(-1, 1);
      canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
      
      if (results.multiFaceLandmarks) {
        for (const landmarks of results.multiFaceLandmarks) {
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
          const currentStatus = classifyFace(landmarks);
          statusText.innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + currentStatus;

          // ‡∏ß‡∏≤‡∏î‡πÉ‡∏¢‡πÅ‡∏°‡∏á‡∏°‡∏∏‡∏° (Tesselation)
          drawConnectors(canvasCtx, landmarks, FACEMESH_TESSELATION,
                        {color: '#00FF00', lineWidth: 0.5});
          
          // ‡∏ß‡∏≤‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô (‡∏ï‡∏≤, ‡∏õ‡∏≤‡∏Å) ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
          drawConnectors(canvasCtx, landmarks, FACEMESH_RIGHT_EYE, {color: '#FF3030', lineWidth: 1});
          drawConnectors(canvasCtx, landmarks, FACEMESH_LEFT_EYE, {color: '#30FF30', lineWidth: 1});
          drawConnectors(canvasCtx, landmarks, FACEMESH_LIPS, {color: '#FFFFFF', lineWidth: 1});
        }
      } else {
        statusText.innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤";
      }
      canvasCtx.restore();
    }

    const faceMesh = new FaceMesh({locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
    }});

    faceMesh.setOptions({
      maxNumFaces: 1,
      refineLandmarks: true,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });
    faceMesh.onResults(onResults);

    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await faceMesh.send({image: videoElement});
      },
      width: 1280,
      height: 720
    });
    camera.start();
  </script>
</body>
</html>